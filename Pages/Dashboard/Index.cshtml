@page
@model Schedulo.Pages.Dashboard.IndexModel
@{
    ViewData["Title"] = "Schedulo | Dashboard";
}

<div class="container mt-4">

    <h2 class="fw-semibold mb-4">ğŸ“Š Dashboard</h2>

    <div class="row g-4">

        <!-- Overdue -->
        <div class="col-md-6">
            <div class="border rounded p-3 h-100">
                <h6 class="text-primary fw-semibold mb-3">ğŸ”¥ Overdue</h6>
                <ul class="list-group list-group-flush" id="overdueList"></ul>
                <p class="text-muted small mt-2" id="overdueEmpty">No overdue assignments ğŸ‰</p>
            </div>
        </div>

        <!-- Due Soon -->
        <div class="col-md-6">
            <div class="border rounded p-3 h-100">
                <h6 class="text-primary fw-semibold mb-3">â° Due Soon</h6>
                <ul class="list-group list-group-flush" id="upcomingList"></ul>
                <p class="text-muted small mt-2" id="upcomingEmpty">Nothing due in the next 7 days ğŸ‘Œ</p>
            </div>
        </div>

    </div>
</div>

@section Scripts {
<script>
function renderDashboard() {
    const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
    const overdueList = document.getElementById('overdueList');
    const upcomingList = document.getElementById('upcomingList');
    const overdueEmpty = document.getElementById('overdueEmpty');
    const upcomingEmpty = document.getElementById('upcomingEmpty');

    overdueList.innerHTML = '';
    upcomingList.innerHTML = '';

    const today = new Date();
    let hasOverdue = false;
    let hasUpcoming = false;

    assignments.forEach(a => {
        const due = new Date(a.dueDate);
        const li = document.createElement('li');
        li.className = 'list-group-item px-0 d-flex justify-content-between align-items-start';
        li.innerHTML = `
            <div>
                <div class="fw-semibold">${a.title}</div>
                <div class="text-muted small">${a.courseCode} â€¢ Due ${due.toLocaleDateString()}</div>
            </div>
            <span class="badge ${due < today ? 'bg-danger' : 'bg-warning text-dark'}">
                ${due < today ? 'Overdue' : a.priority}
            </span>
        `;

        if (due < today) {
            overdueList.appendChild(li);
            hasOverdue = true;
        } else if ((due - today)/(1000*60*60*24) <= 7) {
            upcomingList.appendChild(li);
            hasUpcoming = true;
        }
    });

    overdueEmpty.style.display = hasOverdue ? 'none' : 'block';
    upcomingEmpty.style.display = hasUpcoming ? 'none' : 'block';
}

// Initial render
renderDashboard();

// Optional: update dashboard live when assignments change
window.addEventListener('storage', renderDashboard);
</script>
}
